// This is your Prisma schema file,
generator client {
  provider      = "prisma-client-js"
  output        = "../generated/prisma"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Auth models
model User {
  id                 String           @id @default(uuid())
  email              String           @unique
  name               String?
  weeklySessionCount Int              @default(0)
  weeklyResetAt      DateTime         @default(now())
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt @default(now())
  identities         UserIdentity[]
  sessions           VentureSession[]
  isDeleted          Boolean          @default(false)

  @@index([email])
}

model UserIdentity {
  id         String   @id @default(uuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider   String // 'Google', 'GitHub', 'EmailPassword', 'PhoneOTP', etc.
  providerId String // Provider's unique user ID (or email for email/password)
  metadata   Json? // Provider-specific data (passwordHash, tokens, profile data, etc.)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isDeleted  Boolean  @default(false)

  @@unique([provider, providerId])
  @@index([userId])
}

model Otp {
  id         String   @id @default(uuid())
  identifier String // Phone number or email address
  type       String // 'phone' or 'email'
  otp        String // Hashed OTP
  expiresAt  DateTime
  attempts   Int      @default(0)
  verified   Boolean  @default(false)
  purpose    String? // 'login', 'registration', 'password_reset', '2fa', etc.
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  isDeleted  Boolean  @default(false)

  @@index([identifier, type])
  @@index([expiresAt])
  @@index([identifier, type, verified])
}

model VentureSession {
  id              String           @id @default(uuid())
  userId          String
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  ideaTitle       String
  ideaDescription String
  industry        String
  targetMarket    String
  analysis        VentureAnalysis?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  isDeleted       Boolean          @default(false)

  @@index([userId])
}

model VentureAnalysis {
  id                        String         @id @default(uuid())
  sessionId                 String         @unique
  session                   VentureSession @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  startupViabilityIndex     Int
  marketOpportunityScore    Int
  executionFeasibilityScore Int
  differentiationScore      Int
  monetizationScore         Int
  riskScore                 Int
  riskExposureLevel         String
  executiveSummary          String
  riskAssessment            Json
  mvpPlan                   Json
  positioning               Json
  elevatorPitch             String
  linkedinDraft             String?
  isFallback                Boolean?       @default(false)
  createdAt                 DateTime       @default(now())
  updatedAt                 DateTime       @updatedAt
  isDeleted                 Boolean        @default(false)

  @@index([startupViabilityIndex])
}

model StartupIdea {
  id           Int      @id @default(autoincrement())
  name         String
  idea         String
  industry     String
  score        Int
  oneLinePitch String
  isDeleted    Boolean  @default(false)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([score])
}
